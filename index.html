<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>L&amp;L Decora√ß√µes ‚Äî Portal do Cliente</title>
  <link rel="stylesheet" href="styles.css" />
  <meta name="theme-color" content="rgb(116,97,103)">
  <meta name="color-scheme" content="dark light">
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <img src="assets/logo.png" alt="L&L Decora√ß√µes" class="logo"/>
      <div>
        <h1>L&amp;L Decora√ß√µes</h1>
        <small>Portal do Cliente ‚Äî Contrato ‚Ä¢ Parcelas ‚Ä¢ Pix</small>
      </div>
    </div>
    <nav class="right">
      <span id="whoami" class="muted"></span>
      <button id="btnLogout" class="btn ghost hidden">Sair</button>
    </nav>
  </header>

  <main id="app">
    <!-- LOGIN -->
    <section id="loginView" class="panel">
      <div class="card lg">
        <h2>Entrar</h2>
        <p class="muted">Acesse como <strong>Administrador</strong> ou <strong>Cliente</strong>.</p>
        <div class="grid2">
          <label>CPF
            <input id="inpCPF" inputmode="numeric" placeholder="somente n√∫meros" />
          </label>
          <label>Senha
            <input id="inpSenha" type="password" placeholder="******" />
          </label>
        </div>
        <div class="row">
          <button id="btnEntrar" class="btn">Entrar</button>
        </div>
      </div>
    </section>

    <!-- ADMIN -->
    <section id="adminView" class="panel hidden">
      <div class="toolbar card">
        <h2>Administra√ß√£o</h2>
        <nav class="tabs">
          <button data-tab="usuarios" class="tab active">Clientes</button>
          <button data-tab="novo" class="tab">Criar conta</button>
          <button data-tab="config" class="tab">Config</button>
        </nav>
      </div>

      <div id="tab-usuarios" class="card">
        <table class="table">
          <thead><tr><th>CPF</th><th>Nome</th><th>Servi√ßo</th><th>Parcelas</th><th>Contrato</th><th style="width:280px">A√ß√µes</th></tr></thead>
          <tbody id="tbUsers"></tbody>
        </table>
      </div>

      <div id="tab-novo" class="card hidden">
        <h3>Novo cliente</h3>
        <div class="grid2">
          <label>CPF <input id="novoCPF" inputmode="numeric" placeholder="somente n√∫meros" /></label>
          <label>Nome <input id="novoNome" placeholder="Nome do cliente" /></label>
          <label>Senha inicial <input id="novoSenha" placeholder="Defina uma senha" /></label>
          <label>Servi√ßo/Plano <input id="novoServico" placeholder="Ex.: Evento, Internet 300Mb..." /></label>
          <label>Contrato (URL p√∫blica) <input id="novoContratoUrl" placeholder="https://..." /></label>
          <label>ou Upload do PDF (local) <input id="novoContratoFile" type="file" accept="application/pdf" /></label>
        </div>
        <div class="row"><button id="btnCriar" class="btn">Criar cliente</button></div>
      </div>

      <div id="tab-config" class="card hidden">
        <p><strong>Modo de dados:</strong> <code id="modeLabel">LOCAL</code></p>
        <p class="muted">Local-first (gr√°tis). Para multi-dispositivo real, ative Supabase no <code>config.js</code>.</p>
      </div>

      <div id="editorBox" class="card hidden">
        <div class="row between">
          <h3>Gerenciar <span id="edNome"></span> <small class="muted">(<span id="edCpf"></span>)</small></h3>
          <div class="tabs small">
            <button data-tab="ed-dados" class="tab active">Dados</button>
            <button data-tab="ed-contrato" class="tab">Contrato</button>
            <button data-tab="ed-parcelas" class="tab">Parcelas</button>
          </div>
        </div>

        <div id="tab-ed-dados" class="section">
          <div class="grid2">
            <label>Nome <input id="edNomeIn" /></label>
            <label>Senha (nova) <input id="edSenhaIn" placeholder="deixe vazio p/ manter" /></label>
            <label>Servi√ßo/Plano <input id="edServicoIn" /></label>
          </div>
          <div class="row"><button id="btnSalvarDados" class="btn">Salvar dados</button></div>
        </div>

        <div id="tab-ed-contrato" class="section hidden">
          <div class="grid2">
            <label>Contrato (URL p√∫blica) <input id="edContratoUrlIn" placeholder="https://..." /></label>
            <label>ou Upload PDF (local) <input id="edContratoFile" type="file" accept="application/pdf" /></label>
          </div>
          <div class="row">
            <a id="edContratoLink" target="_blank" class="btn ghost">Abrir em nova aba</a>
            <button id="btnSalvarContrato" class="btn">Salvar contrato</button>
          </div>
        </div>

        <div id="tab-ed-parcelas" class="section hidden">
          <table class="table">
            <thead><tr><th>#</th><th>Vencimento</th><th>Valor</th><th>Status</th><th style="width:280px">A√ß√µes</th></tr></thead>
            <tbody id="tbParcelas"></tbody>
          </table>
          <div class="grid2">
            <label>Vencimento <input id="parVenc" type="date" /></label>
            <label>Valor (R$) <input id="parVal" type="number" step="0.01" /></label>
            <label>Status
              <select id="parStatus">
                <option value="aberto">aberto</option>
                <option value="pago">pago</option>
                <option value="vencido">vencido</option>
              </select>
            </label>
          </div>
          <div class="row"><button id="btnAddParcela" class="btn">Adicionar parcela</button></div>
        </div>
      </div>
    </section>

    <!-- CLIENTE -->
    <section id="clienteView" class="panel hidden">
      <div class="card">
        <div class="row between">
          <h2 id="cliSaudacao">Ol√° üëã</h2>
          <div class="tabs">
            <button data-tab="c-contrato" class="tab active">Contrato</button>
            <button data-tab="c-parcelas" class="tab">Parcelas</button>
          </div>
        </div>

        <div id="tab-c-contrato" class="section">
          <div class="pdfbox">
            <div class="pdfheader row between">
              <div>
                <strong>Contrato:</strong> <span id="cContratoNumero">‚Äî</span> ¬∑
                <strong>Servi√ßo:</strong> <span id="cContratoServico">‚Äî</span> ¬∑
                <strong>Status:</strong> <span id="cContratoStatus">‚Äî</span>
              </div>
              <div class="row gap">
                <button id="btnVerInApp" class="btn ghost">Ver no app</button>
                <a id="btnAbrirAba" class="btn" target="_blank">Abrir em nova aba</a>
              </div>
            </div>
            <div class="pdfviewport">
              <object id="pdfObject" type="application/pdf" data="" aria-label="Visualizador de PDF">
                <div class="muted center">N√£o foi poss√≠vel embutir o PDF. Use o bot√£o ‚ÄúAbrir em nova aba‚Äù.</div>
              </object>
            </div>
          </div>
        </div>

        <div id="tab-c-parcelas" class="section hidden">
          <table class="table">
            <thead><tr><th>#</th><th>Vencimento</th><th>Valor</th><th>Status</th><th style="width:220px">A√ß√µes</th></tr></thead>
            <tbody id="cListaParcelas"></tbody>
          </table>
        </div>
      </div>
    </section>
  </main>

  <!-- Modais -->
  <dialog id="payModal">
    <form method="dialog" class="modal">
      <h3>Pagar com Pix</h3>
      <p><strong>Parcela:</strong> <span id="payParcelaId"></span></p>
      <p><strong>Valor:</strong> R$ <span id="payValor"></span></p>
      <canvas id="qrCanvas" width="256" height="256"></canvas>
      <div class="codebox" id="pixCode"></div>
      <div class="row gap">
        <button id="btnCopy" type="button" class="btn ghost">Copiar c√≥digo</button>
        <button id="btnClose" value="close" class="btn">Fechar</button>
      </div>
    </form>
  </dialog>

  <dialog id="proofModalClient">
    <form method="dialog" class="modal">
      <h3>Enviar comprovante</h3>
      <p><strong>Parcela:</strong> <span id="proofParcelaId"></span></p>
      <input type="file" id="proofFile" accept="image/*,application/pdf" />
      <div class="row gap">
        <button id="btnSendProof" type="button" class="btn">Enviar</button>
        <button value="close" class="btn ghost">Cancelar</button>
      </div>
      <small class="muted">Demo: salvo no navegador (localStorage).</small>
    </form>
  </dialog>

  <div id="toast" class="toast hidden"></div>

  <footer class="foot">
    <small>Criado por Richard Alex @richard.gms</small>
  </footer>

  <script src="config.js"></script>
  <script src="lib/pix.js"></script>
  <script src="app.js"></script>
</body>
</html>
